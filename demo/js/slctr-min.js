/*
 Slctr v.0.3 | github.com/lukasborawski/slctr
 */

var $selectCoordsDt;(function(e,t,n){function o(t){this.settings=e.extend({},s,t);this.init()}var r,i="slctr",s={slctrBox:"#slctrBox",insdElmnts:"img",globalWidth:"undefined",cursorDistance:2};e.fn.doesExist=function(){return this.length>0};var u=function(e,t){var r=n.createElement(e);for(var i in t){r[i]=t[i]}return r};o.prototype={init:function(){var t=e(this.settings.slctrBox);t.doesExist()?r=true:r=console.log("App failed");if(r){var i=t.find(">"+this.settings.insdElmnts),s=u("div",{className:"selectArea"}),o,a,f=400,l=this;var c=0,h=t.find(">"+this.settings.insdElmnts).length;i.data("data","insideObject");i.data("insideObject",i.data("insideObject")).load(function(){function e(){t.width(n).css("visibility","visible");i.wrapAll(s)}c++;if(c>=h){if(l.settings.globalWidth==="undefined"){var n=i.first().width();e()}else{t.width(l.settings.globalWidth);e()}}});function p(e,t){d=false;v=0;m=0;o.remove();if(e){t.off("mousemove");t.off("mousedown")}}var d,v,m=false;e(n.body).on("mousedown",".selectArea",function(r){function c(e,t,n,r){var i=h(e,t,n/2,0);var s=h(e,t,n/2,r);var o=h(e,t,0,r/2);var u=h(e,t,n,r/2);var a=Math.min(i,s,o,u);switch(a){case o:return"left";case u:return"right";case i:return"top";case s:return"bottom"}}function h(e,t,n,r){var i=e-n;var s=t-r;return i*i+s*s}r.preventDefault();d=true;a=e("#selectCoords");if(a.doesExist()){a.remove()}var i=u("input",{type:"hidden",id:"selectCoords"});e(n.body).append(i).one();var s=u("div",{className:"selectMark"});t.append(s);o=e(".selectMark");var g=0,y=0;var b=e(this).offset();e(this).unbind("mousemove").on("mousemove",function(t){if(d){var n=c(t.pageX,t.pageY,e(this).width(),e(this).height());if(n=="left"||n=="top"){var r=t.pageX-b.left,i=t.pageY-b.top;o.css({left:r-l.settings.cursorDistance,top:i-l.settings.cursorDistance});e(this).unbind("mousemove").on("mousemove",function(e){if(d){m&&(y+=e.pageY-m);v&&(g+=e.pageX-v);v=e.pageX;m=e.pageY;o.css({width:g,height:y})}})}else{e(this).unbind("mousemove").on("mousemove",function(e){var t=e.pageX-b.left,n=e.pageY-b.top;m&&(y+=e.pageY-m);v&&(g+=e.pageX-v);v=e.pageX;m=e.pageY;o.css({width:-g,height:-y,top:n+l.settings.cursorDistance,left:t+l.settings.cursorDistance})})}}});e(n).unbind("mouseup").on("mouseup",".selectArea",function(){p(true,e(".selectArea"));var t=r.pageX-b.left,n=r.pageY-b.top;a=e("#selectCoords");g<0?a.data({x:t,y:n,w:-g,h:-y}):a.data({x:t,y:n,w:g,h:y});$selectCoordsDt=a.data();if(typeof l.settings.callback==="function"){l.settings.callback($selectCoordsDt)}});setTimeout(function(){o.on("mouseenter",function(){p()})},f)})}}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(t))}})}})(jQuery,window,document)
